协同过滤算法

在讲解之前我先来简单说明一下什么是协同过滤。所谓协同过滤，就是利用所有用户在某个APP（比如淘宝）上的操作行为，构建一个算法模型（即某种计算规则），为每个用户推荐他可能会感兴趣的物品。最终推荐的目的是提升用户体验，为平台方（如淘宝）创造商业价值。

我要讲解的最简单的协同过滤算法的流程如下图所示（这里以购买水果为例），主要包含3个步骤：**第一步**是构建每个用户的行为记录；**第二步**是根据协同操作行为获得物品的相关度；**第三步**是为某个用户计算推荐结果。这个协同过滤的实现思路是非常简单的，相信大家看看图就能大致理解。在我最早做推荐系统时就是采用的这个方法，很容易编程实现。下面我们分别按照上面的3步进行详细介绍。

 

![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ7eb1VWrnwdlbkWYnXATD05pXaTB8aAptVO7hn38nRqibu2O8PC2n9CQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

图1：最简单的协同过滤算法的实现步骤 

**第一步：构建每个用户的行为记录**

这一步是最简单的。每个用户的操作行为我们是可以通过埋点记录下来的，然后通过日志收集放到数据中心。我们只需要关注用户id、物品id、操作时间、操作行为（如点击、购买、播放时长等）这4个字段就可以了。

用户的行为是可以打分的，得分代表了用户对物品的喜好度。打分可以是基于人工规则的（也就是拍脑袋），也可以基于算法公式。比如购买可以打10分，加购物车打8分，收藏打6分，浏览打4分等。如果是物品是视频，那么可以根据播放完成度来打分，比如100分钟的视频，播放完了80分钟，那么就可以打8分（这里都是10分制）。

用户的行为可能是随时间变化的，我们可以给用户的每一次行为进行时间加权。也可以选择有限次的行为，比如只选择用户最近一段时间的行为（比如最近的一个月）或者选择用户最近若干次行为（比如最近的10次）。

根据上面的描述，一个用户 **U** 的行为记录可以记为：

 ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZOBKianaNDQE58hF6LppZviaa6uz2Ql88MhXIufiajDLtJ6EiaILicQA6eIw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

这里 ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ7RPr7yR2Xuv6A8cMalCLbaJ31tmkIK5z2M12ZLLCz9JJznPvrXZI1w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) 是用户有过操作行为的物品，![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZQchJMiaK6hgOSJ3jSdu9qANPvkvODTiaPuG0oz91qBcWm8MGt3GYia7cA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) 是对应的操作时间（按照先近后远来排列），![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZZYtcS7ddk7E7R8nSIglK24VZzKBgdYs8aGicnTlc025qnSTic4RYGckg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) 分别是用户 **U** 对物品 ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ7RPr7yR2Xuv6A8cMalCLbaJ31tmkIK5z2M12ZLLCz9JJznPvrXZI1w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) 的评分。

通过上面的过程我们就获得了某个用户的行为记录了，其他用户的行为记录都可以按照类似的方式获得。

**第二步：根据协同操作行为获得物品的相关度**

有了用户在过去一段时间（比如过去一年）的所有行为记录，那么就很容易算出任何两个物品之间的关联度了。具体做法如下：

先将所有的物品组合成物品对（假设一共有某个物品，那么这样的对有![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZwADiasBXRMe6aria8k80Hs56h42HkIVfVVEH3kVhNKNAa4kZNFicnviaKg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)对，减去![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZBpbSFibGDOhlmZ1YkW1beV0XBkZd7obIZDc91iaib9q3fXnM1aOBTLGcA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)是因为物品自己和自己不能组成一对），比如![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ9jfADzQaicJ7KMjuE2lMIdrQTpGibwWOFibj9tTK5L1d0LQqYPXWtU65g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)，然后统计所有对![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ9jfADzQaicJ7KMjuE2lMIdrQTpGibwWOFibj9tTK5L1d0LQqYPXWtU65g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)这两个物品有操作行为的用户。假设这样的用户有![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZEhYunp2Tr1cEtn0rAMNc2hD4HUjiaRBu2kyTQyuDB0SNiavAdHDzxkAw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)个：![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZakN0iahBZKhJtJEKTNiavAImn4QjRzsSrzvstL025f4vsSaTcY5UycbQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)。用户![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZYIgznHZxwzd9ppZOic52cPicJLQXHfFATOZqiaobHRF1AA97Pib9Glf57g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)对物品![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ9jfADzQaicJ7KMjuE2lMIdrQTpGibwWOFibj9tTK5L1d0LQqYPXWtU65g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)的评分分别为![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZE1y46wg0jrUsWINia4qnuYiauuVwCyjRatbOGTKuADcWAITlGfVmsjGw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)（这个可以根据第一步获得）。那么![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ9jfADzQaicJ7KMjuE2lMIdrQTpGibwWOFibj9tTK5L1d0LQqYPXWtU65g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)对的最终得分![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZE57fFSuHfdId13wr9NXp5Z7SwmyskyBKvybqSZsIdyvj5GzTTYuIIQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)可以用公式![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZmvxU7XaLRaDibzR67gNGzqiboY8UISI8EAqD9y9ccrA7WK7NTH6mL8TQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)计算得到。根据这个流程，我们可以获得所有的![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZwADiasBXRMe6aria8k80Hs56h42HkIVfVVEH3kVhNKNAa4kZNFicnviaKg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)对物品组合的得分（注意，其实我们的计算量可以减半，因为![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZE57fFSuHfdId13wr9NXp5Z7SwmyskyBKvybqSZsIdyvj5GzTTYuIIQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)=![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZK0KMaedeub2dqicuNeqJkKJ7WHNte3B3jK92led0xNibicksBo0HFfOibg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)），最终的结果可以记录为下表所示的形式。

| 物品组合（一共m个物品）                                      | 一段时间之内用户对物品的评分之和                             |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZb2HT5YglVrVkILqI2Lw3lBzYlrvsVficPNy7OArklTcYCJRotRlSAvw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZsplMic1Dlib37fA03nLsgKq7fcSllAvLhosX5bToZUBd5ySmy0kogFxA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZQqyuAaPuSSOG32gn5CABdQoF5Gqqfs1RbL8exs5iaRicomuXjgxKOickQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZzXP0KwbTbFKX0mjrrZyCPvNpQDlVM1VybmAfzU7vbcyD8DgM2yCXBg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZhEBh82OgsN23cIA2NOmnGzN1da2FDR3jGrcCaDiaq0cLpVMJpGDMJhw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZQJaJR5cng3qg2MGiaWhyTpVze0ZPHhrnqcOLpNibIL9vnTdgGxo9npyQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |
| ......                                                       | ......                                                       |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ9jfADzQaicJ7KMjuE2lMIdrQTpGibwWOFibj9tTK5L1d0LQqYPXWtU65g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZE57fFSuHfdId13wr9NXp5Z7SwmyskyBKvybqSZsIdyvj5GzTTYuIIQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |
| ......                                                       | ......                                                       |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZnxYqqm3onzQ6N1keMAPJgLuJibibq5JRnnpM8TK3m5UaguTzfEHc2w9g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZH34oCl0tdjT5iagR3YREAUykPONzejMCiaQgr4lnN5fjOxWjwtegV3qQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |

表1：两个物品组合及其评分

获得了所有物品对的评分，就可以非常容易地对某个物品![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZeLaLM9ia1sQJMm4RoicUrv3LRxRe317RSbhYgvD7icjOLfVladSN6snwg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)，计算出与它关联的得分最高的![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZDibiacEZZnquvxZHROU9sSFlz7gvM6LoTEKticCdBXFKjS53xfpsVRQvQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)个物品了，这些物品称为与之最相关的物品（之所以每个物品只选择![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZDibiacEZZnquvxZHROU9sSFlz7gvM6LoTEKticCdBXFKjS53xfpsVRQvQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)个最相似的，是基于链两个考虑：一是其他的相似度很小了，相比这![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZDibiacEZZnquvxZHROU9sSFlz7gvM6LoTEKticCdBXFKjS53xfpsVRQvQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)个最相似的可以忽略了；二是只取![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZDibiacEZZnquvxZHROU9sSFlz7gvM6LoTEKticCdBXFKjS53xfpsVRQvQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)个可以减少计算和存储空间，因为一般来说物品的总数是很大的）。也就是从![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZXpBhoqnIVBzKbpFbjJ2bhPy67meXSq2jWVCGO9xu4tiawratHD4ohhw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)中降序排列，选择![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZDibiacEZZnquvxZHROU9sSFlz7gvM6LoTEKticCdBXFKjS53xfpsVRQvQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)个得分最高的得分对应的物品就是与物品![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZeLaLM9ia1sQJMm4RoicUrv3LRxRe317RSbhYgvD7icjOLfVladSN6snwg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)最相关的物品。最终获得的结果可以用下表所示（下表中的![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZFLXLDsZicfic2DDPk5YLWh4rlrXghH2NVsz4iaPcrJ6KLofJTibUjJ1bzg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)是两个物品根据表1获得的相似度）。

| 物品                                                         | 与该物品最相关的                                             |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZXyeF3HrQkqEfiaib3Rb7jDCFbTPdPsmbhSecribPo9SCPGm9IhE0cU17w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZW4h4ibWiaobw2QrYA92v7Z2xWEz4RJMtwhpDBpvOAsEWCYnw9OEmqsvA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZdPKXnkblmAVN278Tw0MPqxhWm9hIvC5hUfGMBpV35RyZib07kc0icdTg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZj6dkKfl8z67CKMUoGQ42cc2Y2r1YJic3KDLZiabacjypN84wdw252bicQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZEefhNVX31yv2ricaOzw7Mq2VJlmoQIa10niaza5rWOkaKC8jJc5Y4QTQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZRWAGalcfx6nyLYKlFpyBWFGicBrTASbPOX05LMAP3e1yiaW8PnKogd8w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |
| ......                                                       | ......                                                       |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZeLaLM9ia1sQJMm4RoicUrv3LRxRe317RSbhYgvD7icjOLfVladSN6snwg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZh4ZRibib0SaMB39qvibYT2J9s2RicUUH8FTXYdhTMsuGkwDczyZfBY9Gfw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |
| ......                                                       | ......                                                       |
| ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZIMpaFUgyg32YoLJG4qnQZzjyTibm0HBbAyZ4wDNibUHp04G693fpEbNQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) | ![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ9uNa06ib7s1w1Qcx17fVjU64JRX51jQuzGHORD36QDG2ylnu89VugXg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) |

表2：某个物品最相似的个物品列表

**第三步：为某个用户计算推荐结果**

有了一、二两步的准备，第三步就是为某个用户![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZveHggsyPZ5f6UmiaztxLndSnwUoeN5yEBkvKfWTia1RZ7UlNbPglVwow/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)做推荐了。假设某个用户的操作行为记录为![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZOBKianaNDQE58hF6LppZviaa6uz2Ql88MhXIufiajDLtJ6EiaILicQA6eIw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)。那么这个用户对某个物品![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZlpKF2nX7GrbBvLMAUoasFE3yTHll0v3ThIgk6zg0OyOcXSIQRrVjTQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)的评分![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZTt4DmibtReyFic1MnFWLZBjn7Emj5EkocdVoCAedvU3KPuVjCTmk6iaFQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)可以按照如下公式计算：![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ4rXIBo29DCl1Y13bicVnVOmPJhEibjdNdtloAK9YOvzrn4521sic9s0Pw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)上面公式中的![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ23A4pHceDmctGaialU0eKP5TL5kicxKdKa9icpmxPzYCkzxibua4VHuXXA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)的具体计算方法为：如果![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZlpKF2nX7GrbBvLMAUoasFE3yTHll0v3ThIgk6zg0OyOcXSIQRrVjTQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)不在![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZicU2yxiariabBM06ECD5VXbVC2RR0NJOHaVDvEba98WFBnyl20ibezo4gQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)最相似的![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZDibiacEZZnquvxZHROU9sSFlz7gvM6LoTEKticCdBXFKjS53xfpsVRQvQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)个物品集中（参见表2，可以获得每个![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZicU2yxiariabBM06ECD5VXbVC2RR0NJOHaVDvEba98WFBnyl20ibezo4gQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)对应的最相似的![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZDibiacEZZnquvxZHROU9sSFlz7gvM6LoTEKticCdBXFKjS53xfpsVRQvQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)个物品集），那么![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ23A4pHceDmctGaialU0eKP5TL5kicxKdKa9icpmxPzYCkzxibua4VHuXXA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) = 0，否则假设![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZhxINpcSqzylfmbg5vltnrT1eg30B0X10tVNbuFKuVFU6Xx9BGvAG7g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)，那么![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZ23A4pHceDmctGaialU0eKP5TL5kicxKdKa9icpmxPzYCkzxibua4VHuXXA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) =![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZFLXLDsZicfic2DDPk5YLWh4rlrXghH2NVsz4iaPcrJ6KLofJTibUjJ1bzg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)。

当我们计算出了用户![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZveHggsyPZ5f6UmiaztxLndSnwUoeN5yEBkvKfWTia1RZ7UlNbPglVwow/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)对所有没有操作行为的物品集合（对于有操作行为的物品，根据用户的操作历史![Image](https://mmbiz.qpic.cn/sz_mmbiz_png/aD40Sib0kia7icydMzYs8n1Yab3JZoaSYuZOBKianaNDQE58hF6LppZviaa6uz2Ql88MhXIufiajDLtJ6EiaILicQA6eIw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)，用户是有评分的）的评分，我们根据评分降序排列取TopN就可以获得给用的最终推荐结果。

这样，根据上面的一、二、三步，我们就可以为任何用户计算个性化推荐了。大家可以看到，上面的算法中完全只用了加减乘法，只要小学数学水平就可以理解（当然，为了通用性，我们采用了比较多的抽象符号来表示，对于没有太强抽象思维的读者，理解起来可能会觉得有点难度）。这个算法为某个用户计算推荐时，是用到了所有用户的行为的 （这在表2计算物品最相似的个物品时用到了），所以根据协同过滤算法的定义，这是一个协同过滤算法。

这个算法如果大家仔细思考，本质上其实就是item-based协同过滤（不了解的读者可以网上查一下，或者参考我之前写的「协同过滤推荐算法」这篇文章），只不过我们这里的讲解方法更容易理解（不需要采用矩阵等高等数学的思路去讲解，用矩阵讲解可能更简洁），这种思路也更容易利用Spark等分布式计算来实现。